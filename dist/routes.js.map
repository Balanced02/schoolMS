{"version":3,"sources":["../server/routes.js"],"names":["router","api","MongoStore","use","secret","process","env","SESSION_SECRET","resave","saveUninitialized","cookie","maxAge","store","mongooseConnection","connection","initialize","session","LocalStrategy","Strategy","authenticate","serializeUser","deserializeUser","static","join","__dirname","get","post"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;;;AAEA;;AACA;;;;AAiBA,IAAMA,SAAS,sBAAf;AACA,IAAMC,MAAM,sBAAZ;;AAEA,IAAMC,aAAa,qDAAnB;AACAF,OAAOG,GAAP,CAAW,6BAAX;AACAH,OAAOG,GAAP,CACE,8BAAQ;AACNC,UAAQC,QAAQC,GAAR,CAAYC,cAAZ,IAA8B,iBADhC;AAENC,UAAQ,IAFF;AAGNC,qBAAmB,KAHb;AAINC,UAAQ;AACNC,YAAQ,KADF,CACS;AADT,GAJF;AAONC,SAAO,IAAIV,UAAJ,CAAe;AACpBW,wBAAoB,mBAASC;AADT,GAAf;AAPD,CAAR,CADF;;AAcA;AACAd,OAAOG,GAAP,CAAW,mBAASY,UAAT,EAAX;AACAf,OAAOG,GAAP,CAAW,mBAASa,OAAT,EAAX;;AAEA,IAAMC,gBAAgB,wBAAcC,QAApC;AACA,mBAASf,GAAT,CAAa,IAAIc,aAAJ,CAAkB,gBAAME,YAAN,EAAlB,CAAb;AACA,mBAASC,aAAT,CAAuB,gBAAMA,aAAN,EAAvB;AACA,mBAASC,eAAT,CAAyB,gBAAMA,eAAN,EAAzB;;AAEArB,OAAOG,GAAP,CAAW,MAAX,EAAmBF,GAAnB;;AAEAD,OAAOG,GAAP,CAAW,kBAAQmB,MAAR,CAAe,eAAKC,IAAL,CAAUC,SAAV,EAAqB,iBAArB,CAAf,CAAX;;AAEA;AACAvB,IAAIwB,GAAJ,CAAQ,KAAR;AACAxB,IAAIyB,IAAJ,CAAS,aAAT,EAAwB,mBAASP,YAAT,CAAsB,OAAtB,CAAxB;AACAlB,IAAIyB,IAAJ,CAAS,gBAAT;AACAzB,IAAIwB,GAAJ,CAAQ,cAAR;;AAEA;AACAxB,IAAIE,GAAJ;;AAEA;AACAF,IAAIwB,GAAJ,CAAQ,aAAR;AACAxB,IAAIwB,GAAJ,CAAQ,YAAR;AACAxB,IAAIwB,GAAJ,CAAQ,cAAR;AACAxB,IAAIwB,GAAJ,CAAQ,cAAR;AACAxB,IAAIwB,GAAJ,CAAQ,WAAR;AACAxB,IAAIwB,GAAJ,CAAQ,eAAR;;AAEA;AACAxB,IAAIyB,IAAJ,CAAS,aAAT;AACAzB,IAAIyB,IAAJ,CAAS,eAAT;AACAzB,IAAIyB,IAAJ,CAAS,eAAT;AACAzB,IAAIyB,IAAJ,CAAS,eAAT;AACAzB,IAAIyB,IAAJ,CAAS,WAAT;AACAzB,IAAIyB,IAAJ,CAAS,cAAT;AACAzB,IAAIyB,IAAJ,CAAS,mBAAT;AACAzB,IAAIyB,IAAJ,CAAS,cAAT;;kBAEe1B,M","file":"routes.js","sourcesContent":["import express, { Router } from 'express';\r\nimport path from 'path';\r\nimport cookieParser from 'cookie-parser';\r\nimport session from 'express-session';\r\nimport passport from 'passport';\r\nimport passportLocal from 'passport-local';\r\nimport mongoose from 'mongoose';\r\nimport connectMongo from 'connect-mongo';\r\n\r\nimport Users from './models/Users';\r\n\r\nimport { Register, Login, Logout, RedirectNoAuth, AuthMe } from './controllers/auth';\r\nimport {\r\n  SummaryData,\r\n  CreateNotice,\r\n  CreateCourse,\r\n  AllCourse,\r\n  UpdateCourse,\r\n  VisitorData,\r\n  GetVisitors,\r\n  GetTeachers,\r\n  AllClass,\r\n  AddClass,\r\n  UpdateClass,\r\n  LeaveApplication,\r\n  GetLeave,\r\n  LeaveUpdate,\r\n} from './controllers/api';\r\n\r\nconst router = Router();\r\nconst api = Router();\r\n\r\nconst MongoStore = connectMongo(session);\r\nrouter.use(cookieParser());\r\nrouter.use(\r\n  session({\r\n    secret: process.env.SESSION_SECRET || 's3cret diz@6l3d',\r\n    resave: true,\r\n    saveUninitialized: false,\r\n    cookie: {\r\n      maxAge: 3.6e6, // 1 Hour session\r\n    },\r\n    store: new MongoStore({\r\n      mongooseConnection: mongoose.connection,\r\n    }),\r\n  })\r\n);\r\n\r\n// PassportJS Setup\r\nrouter.use(passport.initialize());\r\nrouter.use(passport.session());\r\n\r\nconst LocalStrategy = passportLocal.Strategy;\r\npassport.use(new LocalStrategy(Users.authenticate()));\r\npassport.serializeUser(Users.serializeUser());\r\npassport.deserializeUser(Users.deserializeUser());\r\n\r\nrouter.use('/api', api);\r\n\r\nrouter.use(express.static(path.join(__dirname, '../client/build')));\r\n\r\n// Auth\r\napi.get('/me', AuthMe);\r\napi.post('/auth/login', passport.authenticate('local'), Login);\r\napi.post('/auth/register', Register);\r\napi.get('/auth/logout', Logout);\r\n\r\n// Auth Middleware\r\napi.use(RedirectNoAuth);\r\n\r\n//Queries\r\napi.get('/getSummary', SummaryData);\r\napi.get('/allCourse', AllCourse);\r\napi.get('/allVisitors', GetVisitors);\r\napi.get('/allTeachers', GetTeachers);\r\napi.get('/allClass', AllClass);\r\napi.get('/allLeave/:id', GetLeave);\r\n\r\n//actions\r\napi.post('/newVisitor', VisitorData);\r\napi.post('/createNotice', CreateNotice);\r\napi.post('/createCourse', CreateCourse);\r\napi.post('/updateCourse', UpdateCourse);\r\napi.post('/addClass', AddClass);\r\napi.post('/updateClass', UpdateClass);\r\napi.post('/leaveApplication', LeaveApplication);\r\napi.post('/updateLeave', LeaveUpdate);\r\n\r\nexport default router;\r\n"]}