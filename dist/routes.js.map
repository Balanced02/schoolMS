{"version":3,"sources":["../server/routes.js"],"names":["router","admin","api","MongoStore","use","secret","process","env","SESSION_SECRET","resave","saveUninitialized","cookie","maxAge","store","mongooseConnection","connection","initialize","session","LocalStrategy","Strategy","authenticate","serializeUser","deserializeUser","get","static","join","__dirname","post"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;;;AAEA;;AACA;;;;AAUA,IAAMA,SAAS,sBAAf;AACA,IAAMC,QAAQ,sBAAd;AACA,IAAMC,MAAM,sBAAZ;;AAEA,IAAMC,aAAa,qDAAnB;AACAH,OAAOI,GAAP,CAAW,6BAAX;AACAJ,OAAOI,GAAP,CACE,8BAAQ;AACNC,UAAQC,QAAQC,GAAR,CAAYC,cAAZ,IAA8B,iBADhC;AAENC,UAAQ,IAFF;AAGNC,qBAAmB,KAHb;AAINC,UAAQ;AACNC,YAAQ,KADF,CACS;AADT,GAJF;AAONC,SAAO,IAAIV,UAAJ,CAAe;AACpBW,wBAAoB,mBAASC;AADT,GAAf;AAPD,CAAR,CADF;;AAcA;AACAf,OAAOI,GAAP,CAAW,mBAASY,UAAT,EAAX;AACAhB,OAAOI,GAAP,CAAW,mBAASa,OAAT,EAAX;;AAEA,IAAMC,gBAAgB,wBAAcC,QAApC;AACA,mBAASf,GAAT,CAAa,IAAIc,aAAJ,CAAkB,gBAAME,YAAN,EAAlB,CAAb;AACA,mBAASC,aAAT,CAAuB,gBAAMA,aAAN,EAAvB;AACA,mBAASC,eAAT,CAAyB,gBAAMA,eAAN,EAAzB;;AAEAtB,OAAOuB,GAAP,CAAW,GAAX,EAAgBtB,KAAhB;AACAA,MAAMG,GAAN,CAAU,kBAAQoB,MAAR,CAAe,eAAKC,IAAL,CAAUC,SAAV,EAAqB,iBAArB,CAAf,CAAV;;AAEA1B,OAAOI,GAAP,CAAW,MAAX,EAAmBF,GAAnB;;AAEA;AACAA,IAAIqB,GAAJ,CAAQ,KAAR;AACArB,IAAIyB,IAAJ,CAAS,aAAT,EAAwB,mBAASP,YAAT,CAAsB,OAAtB,CAAxB;AACAlB,IAAIyB,IAAJ,CAAS,gBAAT;AACAzB,IAAIqB,GAAJ,CAAQ,cAAR;;AAEA;AACArB,IAAIE,GAAJ;;AAEA;AACAF,IAAIqB,GAAJ,CAAQ,aAAR;AACArB,IAAIyB,IAAJ,CAAS,eAAT;AACAzB,IAAIyB,IAAJ,CAAS,eAAT;AACAzB,IAAIyB,IAAJ,CAAS,eAAT;AACAzB,IAAIqB,GAAJ,CAAQ,YAAR;AACArB,IAAIyB,IAAJ,CAAS,aAAT;AACAzB,IAAIqB,GAAJ,CAAQ,cAAR;;kBAEevB,M","file":"routes.js","sourcesContent":["import express, { Router } from 'express';\r\nimport path from 'path';\r\nimport cookieParser from 'cookie-parser';\r\nimport session from 'express-session';\r\nimport passport from 'passport';\r\nimport passportLocal from 'passport-local';\r\nimport mongoose from 'mongoose';\r\nimport connectMongo from 'connect-mongo';\r\n\r\nimport Admin from './models/Admin';\r\n\r\nimport { Register, Login, Logout, RedirectNoAuth, AuthMe } from './controllers/auth';\r\nimport {\r\n  SummaryData,\r\n  CreateNotice,\r\n  CreateCourse,\r\n  AllCourse,\r\n  UpdateCourse,\r\n  VisitorData,\r\n  GetVisitors,\r\n} from './controllers/api';\r\n\r\nconst router = Router();\r\nconst admin = Router();\r\nconst api = Router();\r\n\r\nconst MongoStore = connectMongo(session);\r\nrouter.use(cookieParser());\r\nrouter.use(\r\n  session({\r\n    secret: process.env.SESSION_SECRET || 's3cret diz@6l3d',\r\n    resave: true,\r\n    saveUninitialized: false,\r\n    cookie: {\r\n      maxAge: 3.6e6, // 1 Hour session\r\n    },\r\n    store: new MongoStore({\r\n      mongooseConnection: mongoose.connection,\r\n    }),\r\n  })\r\n);\r\n\r\n// PassportJS Setup\r\nrouter.use(passport.initialize());\r\nrouter.use(passport.session());\r\n\r\nconst LocalStrategy = passportLocal.Strategy;\r\npassport.use(new LocalStrategy(Admin.authenticate()));\r\npassport.serializeUser(Admin.serializeUser());\r\npassport.deserializeUser(Admin.deserializeUser());\r\n\r\nrouter.get('/', admin);\r\nadmin.use(express.static(path.join(__dirname, '../client/build')));\r\n\r\nrouter.use('/api', api);\r\n\r\n// Auth\r\napi.get('/me', AuthMe);\r\napi.post('/auth/login', passport.authenticate('local'), Login);\r\napi.post('/auth/register', Register);\r\napi.get('/auth/logout', Logout);\r\n\r\n// Auth Middleware\r\napi.use(RedirectNoAuth);\r\n\r\n//Queries\r\napi.get('/getSummary', SummaryData);\r\napi.post('/createNotice', CreateNotice);\r\napi.post('/createCourse', CreateCourse);\r\napi.post('/updateCourse', UpdateCourse);\r\napi.get('/allCourse', AllCourse);\r\napi.post('/newVisitor', VisitorData);\r\napi.get('/allVisitors', GetVisitors);\r\n\r\nexport default router;\r\n"]}