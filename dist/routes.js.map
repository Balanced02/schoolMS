{"version":3,"sources":["../server/routes.js"],"names":["app","router","api","upload","dest","MongoStore","use","secret","process","env","SESSION_SECRET","resave","saveUninitialized","cookie","maxAge","store","mongooseConnection","connection","initialize","session","LocalStrategy","Strategy","authenticate","serializeUser","deserializeUser","static","join","__dirname","get","post","single"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;;;AAEA;;AACA;;;;AA4BA,IAAMA,MAAM,wBAAZ;AACA,IAAMC,SAAS,sBAAf;AACA,IAAMC,MAAM,sBAAZ;;AAEA,IAAIC,SAAS,sBAAO,EAAEC,MAAM,gBAAR,EAAP,CAAb;;AAEA,IAAMC,aAAa,qDAAnB;AACAJ,OAAOK,GAAP,CAAW,6BAAX;AACAL,OAAOK,GAAP,CACE,8BAAQ;AACNC,UAAQC,QAAQC,GAAR,CAAYC,cAAZ,IAA8B,iBADhC;AAENC,UAAQ,IAFF;AAGNC,qBAAmB,KAHb;AAINC,UAAQ;AACNC,YAAQ,KADF,CACS;AADT,GAJF;AAONC,SAAO,IAAIV,UAAJ,CAAe;AACpBW,wBAAoB,mBAASC;AADT,GAAf;AAPD,CAAR,CADF;;AAcA;AACAhB,OAAOK,GAAP,CAAW,mBAASY,UAAT,EAAX;AACAjB,OAAOK,GAAP,CAAW,mBAASa,OAAT,EAAX;;AAEA,IAAMC,gBAAgB,wBAAcC,QAApC;AACA,mBAASf,GAAT,CAAa,IAAIc,aAAJ,CAAkB,gBAAME,YAAN,EAAlB,CAAb;AACA,mBAASC,aAAT,CAAuB,gBAAMA,aAAN,EAAvB;AACA,mBAASC,eAAT,CAAyB,gBAAMA,eAAN,EAAzB;;AAEAvB,OAAOK,GAAP,CAAW,MAAX,EAAmBJ,GAAnB;;AAEAD,OAAOK,GAAP,CAAW,kBAAQmB,MAAR,CAAe,eAAKC,IAAL,CAAUC,SAAV,EAAqB,iBAArB,CAAf,CAAX;;AAEA;AACAzB,IAAI0B,GAAJ,CAAQ,KAAR;AACA1B,IAAI2B,IAAJ,CAAS,aAAT,EAAwB,mBAASP,YAAT,CAAsB,OAAtB,CAAxB;AACApB,IAAI2B,IAAJ,CAAS,oBAAT;AACA3B,IAAI2B,IAAJ,CAAS,gBAAT;AACA3B,IAAI0B,GAAJ,CAAQ,cAAR;;AAEA;AACA1B,IAAII,GAAJ;;AAEA;AACAJ,IAAI0B,GAAJ,CAAQ,aAAR;AACA1B,IAAI0B,GAAJ,CAAQ,YAAR;AACA1B,IAAI0B,GAAJ,CAAQ,cAAR;AACA1B,IAAI0B,GAAJ,CAAQ,cAAR;AACA1B,IAAI0B,GAAJ,CAAQ,WAAR;AACA1B,IAAI0B,GAAJ,CAAQ,eAAR;AACA1B,IAAI0B,GAAJ,CAAQ,mBAAR;AACA1B,IAAI0B,GAAJ,CAAQ,iBAAR;AACA1B,IAAI0B,GAAJ,CAAQ,kBAAR;AACA1B,IAAI0B,GAAJ,CAAQ,oBAAR;AACA1B,IAAI0B,GAAJ,CAAQ,aAAR;;AAEA;AACA1B,IAAI2B,IAAJ,CAAS,aAAT;AACA3B,IAAI2B,IAAJ,CAAS,eAAT;AACA3B,IAAI2B,IAAJ,CAAS,eAAT;AACA3B,IAAI2B,IAAJ,CAAS,eAAT;AACA3B,IAAI2B,IAAJ,CAAS,WAAT;AACA3B,IAAI2B,IAAJ,CAAS,cAAT;AACA3B,IAAI2B,IAAJ,CAAS,mBAAT;AACA3B,IAAI2B,IAAJ,CAAS,cAAT;AACA3B,IAAI2B,IAAJ,CAAS,gBAAT;AACA3B,IAAI2B,IAAJ,CAAS,mBAAT;AACA3B,IAAI2B,IAAJ,CAAS,kBAAT;AACA3B,IAAI2B,IAAJ,CAAS,oBAAT;AACA3B,IAAI2B,IAAJ,CAAS,aAAT;AACA3B,IAAI2B,IAAJ,CAAS,aAAT,EAAwB1B,OAAO2B,MAAP,CAAc,OAAd,CAAxB;;kBAEe7B,M","file":"routes.js","sourcesContent":["import express, { Router } from 'express';\r\nimport path from 'path';\r\nimport cookieParser from 'cookie-parser';\r\nimport session from 'express-session';\r\nimport passport from 'passport';\r\nimport passportLocal from 'passport-local';\r\nimport mongoose from 'mongoose';\r\nimport connectMongo from 'connect-mongo';\r\nimport multer from 'multer';\r\n\r\nimport Users from './models/Users';\r\n\r\nimport { Register, Login, Logout, RedirectNoAuth, AuthMe, CreateSchool } from './controllers/auth';\r\nimport {\r\n  SummaryData,\r\n  CreateNotice,\r\n  CreateCourse,\r\n  AllCourse,\r\n  UpdateCourse,\r\n  VisitorData,\r\n  GetVisitors,\r\n  GetTeachers,\r\n  AllClass,\r\n  AddClass,\r\n  UpdateClass,\r\n  LeaveApplication,\r\n  GetLeave,\r\n  LeaveUpdate,\r\n  NewDepartment,\r\n  FetchDepartment,\r\n  CategoryUpdate,\r\n  GetLeaveCategory,\r\n  GetUserCategory,\r\n  AddUserCategory,\r\n  AddPayHead,\r\n  GetPayHead,\r\n  EditSchool,\r\n  GetSchools,\r\n  UploadFile,\r\n} from './controllers/api';\r\n\r\nconst app = express();\r\nconst router = Router();\r\nconst api = Router();\r\n\r\nvar upload = multer({ dest: './public/logos' });\r\n\r\nconst MongoStore = connectMongo(session);\r\nrouter.use(cookieParser());\r\nrouter.use(\r\n  session({\r\n    secret: process.env.SESSION_SECRET || 's3cret diz@6l3d',\r\n    resave: true,\r\n    saveUninitialized: false,\r\n    cookie: {\r\n      maxAge: 3.6e6, // 1 Hour session\r\n    },\r\n    store: new MongoStore({\r\n      mongooseConnection: mongoose.connection,\r\n    }),\r\n  })\r\n);\r\n\r\n// PassportJS Setup\r\nrouter.use(passport.initialize());\r\nrouter.use(passport.session());\r\n\r\nconst LocalStrategy = passportLocal.Strategy;\r\npassport.use(new LocalStrategy(Users.authenticate()));\r\npassport.serializeUser(Users.serializeUser());\r\npassport.deserializeUser(Users.deserializeUser());\r\n\r\nrouter.use('/api', api);\r\n\r\nrouter.use(express.static(path.join(__dirname, '../client/build')));\r\n\r\n// Auth\r\napi.get('/me', AuthMe);\r\napi.post('/auth/login', passport.authenticate('local'), Login);\r\napi.post('/auth/createSchool', CreateSchool);\r\napi.post('/auth/register', Register);\r\napi.get('/auth/logout', Logout);\r\n\r\n// Auth Middleware\r\napi.use(RedirectNoAuth);\r\n\r\n//Queries\r\napi.get('/getSummary', SummaryData);\r\napi.get('/allCourse', AllCourse);\r\napi.get('/allVisitors', GetVisitors);\r\napi.get('/allTeachers', GetTeachers);\r\napi.get('/allClass', AllClass);\r\napi.get('/allLeave/:id', GetLeave);\r\napi.get('/getLeaveCategory', GetLeaveCategory);\r\napi.get('/getDepartments', FetchDepartment);\r\napi.get('/getUserCategory', GetUserCategory);\r\napi.get('/getPayRollDetails', GetPayHead);\r\napi.get('/getSchools', GetSchools);\r\n\r\n//actions\r\napi.post('/newVisitor', VisitorData);\r\napi.post('/createNotice', CreateNotice);\r\napi.post('/createCourse', CreateCourse);\r\napi.post('/updateCourse', UpdateCourse);\r\napi.post('/addClass', AddClass);\r\napi.post('/updateClass', UpdateClass);\r\napi.post('/leaveApplication', LeaveApplication);\r\napi.post('/updateLeave', LeaveUpdate);\r\napi.post('/newDepartment', NewDepartment);\r\napi.post('/addLeaveCategory', CategoryUpdate);\r\napi.post('/addUserCategory', AddUserCategory);\r\napi.post('/addPayRollDetails', AddPayHead);\r\napi.post('/editSchool', EditSchool);\r\napi.post('/uploadFile', upload.single('logos'), UploadFile);\r\n\r\nexport default router;\r\n"]}